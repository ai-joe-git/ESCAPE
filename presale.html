<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBT Private Presale - Blockchains.Bond Token</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #3b82f6 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
        }

        .logo i {
            margin-right: 10px;
            color: #dc2626;
        }

        .wallet-connect {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        .wallet-connect:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }

        .wallet-connect:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Main Content */
        .main-content {
            padding: 4rem 0;
            color: white;
        }

        .presale-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: start;
        }

        /* Left Side - Information */
        .presale-info {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .presale-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #60a5fa, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .presale-subtitle {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .countdown-timer {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        .time-unit {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 12px;
        }

        .time-number {
            font-size: 2rem;
            font-weight: 800;
            color: #60a5fa;
        }

        .time-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .presale-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Right Side - Investment Panel */
        .investment-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            color: #333;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .panel-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 2rem;
            text-align: center;
        }

        .investment-tiers {
            margin-bottom: 2rem;
        }

        .tier-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tier-card.selected {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        }

        .tier-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .tier-name {
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }

        .tier-bonus {
            color: #dc2626;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .tier-amount {
            color: #64748b;
            font-size: 0.9rem;
        }

        .investment-form {
            margin-top: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
        }

        .input-group {
            position: relative;
        }

        .input-group input {
            width: 100%;
            padding: 1rem 3rem 1rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .input-suffix {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-weight: 600;
        }

        .calculation-display {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .calc-row.total {
            border-top: 2px solid #e5e7eb;
            padding-top: 1rem;
            margin-top: 1rem;
            font-weight: 700;
            color: #1e3a8a;
        }

        .invest-button {
            width: 100%;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            padding: 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .invest-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.3);
        }

        .invest-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Tokenomics Section */
        .tokenomics {
            margin-top: 4rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tokenomics-title {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
        }

        .tokenomics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .tokenomics-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
        }

        .tokenomics-icon {
            font-size: 3rem;
            color: #60a5fa;
            margin-bottom: 1rem;
        }

        .tokenomics-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .tokenomics-label {
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        /* Progress Bar */
        .progress-section {
            margin: 2rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc2626, #ef4444);
            border-radius: 10px;
            width: 45%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            font-weight: 600;
        }

        /* Alert Messages */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-weight: 600;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }

        /* Footer */
        .footer {
            background: rgba(0, 0, 0, 0.3);
            padding: 2rem 0;
            margin-top: 4rem;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .disclaimer {
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .presale-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .countdown-timer {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .presale-title {
                font-size: 2rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="container">
            <div class="logo">
                <i class="fas fa-link"></i>
                Blockchains.Bond
            </div>
            <button id="connectWallet" class="wallet-connect">
                <i class="fas fa-wallet"></i> Connect Wallet
            </button>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <div class="presale-grid">
                <!-- Left Side - Information -->
                <div class="presale-info">
                    <h1 class="presale-title">BBT Private Presale</h1>
                    <p class="presale-subtitle">Exclusive early access to Blockchains.Bond Token (BBT) - The first tokenized government bond ecosystem token</p>
                    
                    <!-- Countdown Timer -->
                    <div class="countdown-timer">
                        <div class="time-unit">
                            <div class="time-number" id="days">15</div>
                            <div class="time-label">Days</div>
                        </div>
                        <div class="time-unit">
                            <div class="time-number" id="hours">08</div>
                            <div class="time-label">Hours</div>
                        </div>
                        <div class="time-unit">
                            <div class="time-number" id="minutes">42</div>
                            <div class="time-label">Minutes</div>
                        </div>
                        <div class="time-unit">
                            <div class="time-number" id="seconds">30</div>
                            <div class="time-label">Seconds</div>
                        </div>
                    </div>

                    <!-- Presale Stats -->
                    <div class="presale-stats">
                        <div class="stat-card">
                            <div class="stat-value">$0.12</div>
                            <div class="stat-label">Presale Price</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">$0.25</div>
                            <div class="stat-label">Public Price</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">108%</div>
                            <div class="stat-label">ROI at Launch</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">5M</div>
                            <div class="stat-label">Total Supply</div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress-section">
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <div class="progress-text">450,000 / 1,000,000 BBT Sold (45%)</div>
                    </div>

                    <!-- Key Benefits -->
                    <div style="margin-top: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: #60a5fa;">Presale Benefits:</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> 52% discount from public price</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Bonus tokens based on investment tier</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Early access to bond tokenization platform</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Governance rights and voting power</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Exclusive investor community access</li>
                        </ul>
                    </div>
                </div>

                <!-- Right Side - Investment Panel -->
                <div class="investment-panel">
                    <h2 class="panel-title">Invest in BBT Token</h2>
                    
                    <div id="alertContainer"></div>

                    <!-- Investment Tiers -->
                    <div class="investment-tiers">
                        <div class="tier-card" data-tier="seed" data-bonus="25">
                            <div class="tier-name">Seed Tier</div>
                            <div class="tier-bonus">+25% Bonus Tokens</div>
                            <div class="tier-amount">Minimum: 10 ETH</div>
                        </div>
                        <div class="tier-card" data-tier="private" data-bonus="15">
                            <div class="tier-name">Private Tier</div>
                            <div class="tier-bonus">+15% Bonus Tokens</div>
                            <div class="tier-amount">Minimum: 5 ETH</div>
                        </div>
                        <div class="tier-card selected" data-tier="early" data-bonus="10">
                            <div class="tier-name">Early Bird</div>
                            <div class="tier-bonus">+10% Bonus Tokens</div>
                            <div class="tier-amount">Minimum: 1 ETH</div>
                        </div>
                        <div class="tier-card" data-tier="standard" data-bonus="0">
                            <div class="tier-name">Standard</div>
                            <div class="tier-bonus">No Bonus</div>
                            <div class="tier-amount">Minimum: 0.1 ETH</div>
                        </div>
                    </div>

                    <!-- Investment Form -->
                    <div class="investment-form">
                        <div class="form-group">
                            <label for="ethAmount">Investment Amount</label>
                            <div class="input-group">
                                <input type="number" id="ethAmount" placeholder="0.0" min="0.1" step="0.1">
                                <div class="input-suffix">ETH</div>
                            </div>
                        </div>

                        <!-- Calculation Display -->
                        <div class="calculation-display">
                            <div class="calc-row">
                                <span>BBT Tokens:</span>
                                <span id="baseTokens">0</span>
                            </div>
                            <div class="calc-row">
                                <span>Bonus Tokens:</span>
                                <span id="bonusTokens">0</span>
                            </div>
                            <div class="calc-row total">
                                <span>Total BBT Tokens:</span>
                                <span id="totalTokens">0</span>
                            </div>
                        </div>

                        <button id="investButton" class="invest-button" disabled>
                            <i class="fas fa-rocket"></i> Connect Wallet to Invest
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tokenomics Section -->
            <div class="tokenomics">
                <h2 class="tokenomics-title">BBT Tokenomics</h2>
                <div class="tokenomics-grid">
                    <div class="tokenomics-card">
                        <div class="tokenomics-icon"><i class="fas fa-coins"></i></div>
                        <div class="tokenomics-value">5,000,000</div>
                        <div class="tokenomics-label">Total Supply</div>
                    </div>
                    <div class="tokenomics-card">
                        <div class="tokenomics-icon"><i class="fas fa-chart-pie"></i></div>
                        <div class="tokenomics-value">20%</div>
                        <div class="tokenomics-label">Private Sale</div>
                    </div>
                    <div class="tokenomics-card">
                        <div class="tokenomics-icon"><i class="fas fa-users"></i></div>
                        <div class="tokenomics-value">30%</div>
                        <div class="tokenomics-label">Public Sale</div>
                    </div>
                    <div class="tokenomics-card">
                        <div class="tokenomics-icon"><i class="fas fa-seedling"></i></div>
                        <div class="tokenomics-value">15%</div>
                        <div class="tokenomics-label">Ecosystem Development</div>
                    </div>
                    <div class="tokenomics-card">
                        <div class="tokenomics-icon"><i class="fas fa-hand-holding-usd"></i></div>
                        <div class="tokenomics-value">10%</div>
                        <div class="tokenomics-label">Team (24mo vesting)</div>
                    </div>
                    <div class="tokenomics-card">
                        <div class="tokenomics-icon"><i class="fas fa-handshake"></i></div>
                        <div class="tokenomics-value">10%</div>
                        <div class="tokenomics-label">Partnerships</div>
                    </div>
                    <div class="tokenomics-card">
                        <div class="tokenomics-icon"><i class="fas fa-bullhorn"></i></div>
                        <div class="tokenomics-value">10%</div>
                        <div class="tokenomics-label">Marketing</div>
                    </div>
                    <div class="tokenomics-card">
                        <div class="tokenomics-icon"><i class="fas fa-shield-alt"></i></div>
                        <div class="tokenomics-value">5%</div>
                        <div class="tokenomics-label">Reserve Fund</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <div class="disclaimer">
                <p><strong>Important Disclaimer:</strong> This is a private presale for BBT tokens. Tokens will be airdropped to your wallet address after the public launch. This offering is limited to qualified investors only. Please ensure you understand the risks involved in cryptocurrency investments. By participating, you acknowledge that you are investing in a high-risk asset and that the value of tokens may fluctuate significantly.</p>
                <p style="margin-top: 1rem;"><strong>Presale Wallet:</strong> 0xd9c940f5fD289e20D0fbFfCE24Ed674CAB6f250e</p>
            </div>
        </div>
    </div>

<script>
    // Global variables
    let web3;
    let userAccount;
    const PRESALE_WALLET = '0xd9c940f5fD289e20D0fbFfCE24Ed674CAB6f250e'; // Replace with your actual wallet
    const BBT_PRICE_ETH = 0.00005; // 1 BBT = 0.00005 ETH ($0.12 at $2400 ETH)
    
    // Investment tiers
    const tiers = {
        seed: { minETH: 10, bonus: 25 },
        private: { minETH: 5, bonus: 15 },
        early: { minETH: 1, bonus: 10 },
        standard: { minETH: 0.1, bonus: 0 }
    };

    let selectedTier = 'early';

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        initializeCountdown();
        setupEventListeners();
        updateCalculation();
    });

    // Countdown timer
    function initializeCountdown() {
        const endDate = new Date();
        endDate.setDate(endDate.getDate() + 15);
        endDate.setHours(23, 59, 59);

        function updateCountdown() {
            const now = new Date();
            const timeLeft = endDate - now;

            if (timeLeft > 0) {
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                document.getElementById('days').textContent = days.toString().padStart(2, '0');
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            }
        }

        updateCountdown();
        setInterval(updateCountdown, 1000);
    }

    // Event listeners
    function setupEventListeners() {
        // Wallet connection
        document.getElementById('connectWallet').addEventListener('click', connectWallet);

        // Tier selection
        document.querySelectorAll('.tier-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.tier-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedTier = this.dataset.tier;
                updateCalculation();
            });
        });

        // ETH amount input
        document.getElementById('ethAmount').addEventListener('input', updateCalculation);

        // Invest button
        document.getElementById('investButton').addEventListener('click', makeInvestment);
    }

    // Connect wallet - FIXED VERSION
    async function connectWallet() {
        if (typeof window.ethereum !== 'undefined') {
            try {
                // Request account access
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                // Initialize web3
                web3 = new Web3(window.ethereum);
                
                // Get accounts
                const accounts = await web3.eth.getAccounts();
                userAccount = accounts[0];
                
                // Check if we're on the right network (Mainnet)
                const chainId = await web3.eth.getChainId();
                if (chainId !== 1) {
                    showAlert('Please switch to Ethereum Mainnet to participate in the presale.', 'error');
                    return;
                }
                
                // Update UI
                document.getElementById('connectWallet').innerHTML = `<i class="fas fa-check"></i> ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                document.getElementById('investButton').disabled = false;
                document.getElementById('investButton').innerHTML = '<i class="fas fa-rocket"></i> Invest Now';
                
                showAlert('Wallet connected successfully!', 'success');
                
                // Listen for account changes
                window.ethereum.on('accountsChanged', function (accounts) {
                    if (accounts.length === 0) {
                        // User disconnected wallet
                        userAccount = null;
                        document.getElementById('connectWallet').innerHTML = '<i class="fas fa-wallet"></i> Connect Wallet';
                        document.getElementById('investButton').disabled = true;
                        document.getElementById('investButton').innerHTML = '<i class="fas fa-rocket"></i> Connect Wallet to Invest';
                    } else {
                        userAccount = accounts[0];
                        document.getElementById('connectWallet').innerHTML = `<i class="fas fa-check"></i> ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                    }
                });
                
            } catch (error) {
                console.error('Wallet connection error:', error);
                showAlert('Failed to connect wallet: ' + error.message, 'error');
            }
        } else {
            showAlert('Please install MetaMask to participate in the presale.', 'error');
        }
    }

    // Update calculation
    function updateCalculation() {
        const ethAmount = parseFloat(document.getElementById('ethAmount').value) || 0;
        const tierInfo = tiers[selectedTier];
        
        // Calculate base tokens
        const baseTokens = ethAmount / BBT_PRICE_ETH;
        
        // Calculate bonus tokens
        const bonusTokens = baseTokens * (tierInfo.bonus / 100);
        
        // Total tokens
        const totalTokens = baseTokens + bonusTokens;
        
        // Update display
        document.getElementById('baseTokens').textContent = formatNumber(baseTokens);
        document.getElementById('bonusTokens').textContent = formatNumber(bonusTokens);
        document.getElementById('totalTokens').textContent = formatNumber(totalTokens);
        
        // Update button state
        const investButton = document.getElementById('investButton');
        if (userAccount && ethAmount >= tierInfo.minETH) {
            investButton.disabled = false;
            investButton.innerHTML = `<i class="fas fa-rocket"></i> Invest ${ethAmount} ETH`;
        } else if (userAccount && ethAmount < tierInfo.minETH && ethAmount > 0) {
            investButton.disabled = true;
            investButton.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Minimum ${tierInfo.minETH} ETH`;
        } else if (userAccount) {
            investButton.disabled = false;
            investButton.innerHTML = '<i class="fas fa-rocket"></i> Invest Now';
        }
    }

    // Make investment - COMPLETELY REWRITTEN VERSION
    async function makeInvestment() {
        const ethAmount = parseFloat(document.getElementById('ethAmount').value);
        const tierInfo = tiers[selectedTier];
        
        // Validation
        if (!userAccount) {
            showAlert('Please connect your wallet first.', 'error');
            return;
        }
        
        if (!ethAmount || ethAmount <= 0) {
            showAlert('Please enter a valid investment amount.', 'error');
            return;
        }
        
        if (ethAmount < tierInfo.minETH) {
            showAlert(`Minimum investment for ${selectedTier} tier is ${tierInfo.minETH} ETH.`, 'error');
            return;
        }
        
        // Check if wallet address is valid
        if (!web3.utils.isAddress(PRESALE_WALLET)) {
            showAlert('Invalid presale wallet address. Please contact support.', 'error');
            return;
        }
        
        try {
            // Update button to loading state
            const investButton = document.getElementById('investButton');
            const originalButtonText = investButton.innerHTML;
            investButton.disabled = true;
            investButton.innerHTML = '<div class="loading"></div> Processing Transaction...';
            
            // Check user balance
            const balance = await web3.eth.getBalance(userAccount);
            const balanceInEth = web3.utils.fromWei(balance, 'ether');
            
            if (parseFloat(balanceInEth) < ethAmount) {
                throw new Error('Insufficient ETH balance');
            }
            
            // Estimate gas
            const gasEstimate = await web3.eth.estimateGas({
                from: userAccount,
                to: PRESALE_WALLET,
                value: web3.utils.toWei(ethAmount.toString(), 'ether')
            });
            
            // Get current gas price
            const gasPrice = await web3.eth.getGasPrice();
            
            // Send transaction
            const transactionHash = await web3.eth.sendTransaction({
                from: userAccount,
                to: PRESALE_WALLET,
                value: web3.utils.toWei(ethAmount.toString(), 'ether'),
                gas: Math.round(gasEstimate * 1.2), // Add 20% buffer
                gasPrice: gasPrice
            });
            
            // Calculate tokens for confirmation
            const baseTokens = ethAmount / BBT_PRICE_ETH;
            const bonusTokens = baseTokens * (tierInfo.bonus / 100);
            const totalTokens = baseTokens + bonusTokens;
            
            // Success message
            showAlert(`
                <strong>Investment Successful!</strong><br>
                Transaction Hash: ${transactionHash.transactionHash || transactionHash}<br>
                You will receive <strong>${formatNumber(totalTokens)} BBT tokens</strong> via airdrop after public launch.<br>
                <small>Save this transaction hash for your records.</small>
            `, 'success');
            
            // Reset form
            document.getElementById('ethAmount').value = '';
            updateCalculation();
            
            // Reset button after delay
            setTimeout(() => {
                investButton.disabled = false;
                investButton.innerHTML = originalButtonText;
            }, 5000);
            
        } catch (error) {
            console.error('Investment error:', error);
            
            // Reset button immediately on error
            const investButton = document.getElementById('investButton');
            investButton.disabled = false;
            investButton.innerHTML = '<i class="fas fa-rocket"></i> Invest Now';
            
            // Handle different error types
            if (error.code === 4001) {
                showAlert('Transaction cancelled by user.', 'info');
            } else if (error.message.includes('insufficient funds')) {
                showAlert('Insufficient ETH balance to complete this transaction.', 'error');
            } else if (error.message.includes('User denied')) {
                showAlert('Transaction denied by user.', 'info');
            } else {
                showAlert('Transaction failed: ' + (error.message || 'Unknown error occurred'), 'error');
            }
        }
    }

    // Utility functions
    function formatNumber(num) {
        if (num >= 1000000) {
            return (num / 1000000).toFixed(2) + 'M';
        } else if (num >= 1000) {
            return (num / 1000).toFixed(2) + 'K';
        } else {
            return num.toFixed(0);
        }
    }

    function showAlert(message, type) {
        const alertContainer = document.getElementById('alertContainer');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.innerHTML = message;
        
        alertContainer.innerHTML = '';
        alertContainer.appendChild(alert);
        
        // Auto-remove alert after 8 seconds for success messages
        setTimeout(() => {
            if (alert.parentNode) {
                alert.remove();
            }
        }, type === 'success' ? 8000 : 5000);
    }

    // Check if wallet is already connected on page load
    if (typeof window.ethereum !== 'undefined') {
        window.ethereum.request({ method: 'eth_accounts' }).then(accounts => {
            if (accounts.length > 0) {
                web3 = new Web3(window.ethereum);
                userAccount = accounts[0];
                document.getElementById('connectWallet').innerHTML = `<i class="fas fa-check"></i> ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                document.getElementById('investButton').disabled = false;
                document.getElementById('investButton').innerHTML = '<i class="fas fa-rocket"></i> Invest Now';
            }
        }).catch(console.error);
    }
</script>

</body>
</html>
